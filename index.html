<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¶œê¸ˆ ì‹œ ë°°ë‹¹ ê³„ì‚°ê¸° | Tornado Cash</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Share+Tech+Mono&family=Noto+Sans+KR:wght@300;400&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a0b;
      --bg-card: #111113;
      --border: #1a1a1e;
      --neon: #00ff88;
      --neon-dim: #00cc6a;
      --neon-glow: rgba(0, 255, 136, 0.35);
      --text: #e0e0e0;
      --text-muted: #6b7280;
      --danger: #ff3366;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'JetBrains Mono', 'Share Tech Mono', monospace;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Grid background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 560px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2.5rem;
    }

    .header-logo {
      width: 48px;
      height: 48px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .header-text {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.35rem;
      text-align: center;
    }

    .logo {
      font-size: 1.35rem;
      font-weight: 900;
      color: var(--neon);
      text-shadow: 0 0 20px var(--neon-glow);
      letter-spacing: 0.08em;
      margin-bottom: 0;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      line-height: 1.2;
    }

    .subtitle-telegram {
      font-family: 'Noto Sans KR', sans-serif;
      font-weight: 400;
      letter-spacing: 0.06em;
      text-transform: none;
      font-size: 0.8rem;
      color: var(--text);
      line-height: 1.4;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
    }

    .card-title {
      font-size: 0.7rem;
      color: var(--neon);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 1.25rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    .input-group {
      margin-bottom: 1.25rem;
    }

    .input-group:last-of-type {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
      letter-spacing: 0.05em;
    }

    input {
      width: 100%;
      padding: 0.85rem 1rem;
      font-family: inherit;
      font-size: 1rem;
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus {
      outline: none;
      border-color: var(--neon);
      box-shadow: 0 0 0 2px var(--neon-glow);
    }

    input::placeholder {
      color: var(--text-muted);
      opacity: 0.7;
    }

    .hint {
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
    }

    .data-value {
      padding: 0.85rem 1rem;
      font-size: 1rem;
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--neon);
      font-weight: 600;
    }

    .data-value .price-krw-ref {
      font-size: 0.75em;
      color: var(--text-muted);
      font-weight: 400;
    }

    .data-value.loading {
      color: var(--text-muted);
      font-weight: 400;
    }

    .data-value.error {
      color: var(--danger);
    }

    .card-dividend .share-block {
      margin-bottom: 1.5rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid var(--border);
    }

    .share-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .share-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .share-percent {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--danger);
    }

    .share-bar-wrap {
      margin: 0;
      height: 6px;
      background: var(--bg-dark);
      border-radius: 3px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .share-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-dim), var(--neon));
      border-radius: 2px;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px var(--neon-glow);
    }

    .results {
      margin-top: 0;
    }

    .result-section-title {
      font-size: 0.7rem;
      color: var(--neon);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 0.6rem;
      padding-top: 0.25rem;
    }

    .result-section-divider {
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--border), var(--neon-dim), var(--border), transparent);
      margin: 1.25rem 0 1rem;
      border-radius: 1px;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
      gap: 1rem;
    }

    .result-row:last-child {
      border-bottom: none;
    }

    .result-label {
      color: var(--text-muted);
      font-size: 0.8rem;
      flex-shrink: 0;
      padding-top: 0.1rem;
    }

    .result-value-wrap {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 0.9rem;
      min-width: 0;
    }

    .result-value {
      color: var(--neon);
      font-weight: 600;
      text-shadow: 0 0 10px var(--neon-glow);
      font-size: 0.9rem;
    }

    .result-krw {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
      font-weight: 400;
    }

    .footer-note {
      text-align: center;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 2rem;
      line-height: 1.6;
    }

    .footer-note a {
      color: var(--neon);
      text-decoration: none;
    }

    .footer-note a:hover {
      text-decoration: underline;
    }

    @media (max-width: 480px) {
      .container {
        padding: 1.25rem 1rem;
      }
      .card {
        padding: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="./logo.png" alt="" class="header-logo" onerror="this.style.display='none'">
      <div class="header-text">
        <div class="logo">Tornado Cash Reward</div>
        <div class="subtitle subtitle-telegram">í† ë„¤ì´ë„ ìºì‹œ í•œêµ­ í…”ë ˆê·¸ë¨ë°© ì œê³µ ğŸ‡°ğŸ‡·</div>
      </div>
    </header>

    <div class="card">
      <div class="card-title">â–¸ í˜„ì¬ ì‹œì¥ ë°ì´í„°</div>
      <div class="input-group">
        <label>í˜„ì¬ ìŠ¤í…Œì´í‚¹ ì´ëŸ‰</label>
        <div class="data-value" id="totalStakedDisplay">â€” ë¡œë”© ì¤‘</div>
      </div>
      <div class="input-group">
        <label>í˜„ì¬ ê°€ê²© (USD)</label>
        <div class="data-value" id="priceDisplay">â€” ë¡œë”© ì¤‘</div>
      </div>
      <div class="input-group">
        <label>í˜„ì¬ ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„</label>
        <div class="data-value" id="kimchiPremiumDisplay">â€” ë¡œë”© ì¤‘</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">â–¸ ì…ë ¥</div>
      <div class="input-group">
        <label for="userTorn">ë‚´ TORN ë³´ìœ ëŸ‰</label>
        <input type="number" id="userTorn" placeholder="ì˜ˆ: 1000" min="0" step="any" value="">
      </div>
      <div class="input-group">
        <label for="totalPool">ì „ì²´ ìŠ¤í…Œì´í‚¹ í’€ ê·œëª¨ (TORN)</label>
        <input type="number" id="totalPool" placeholder="ì˜ˆ: 500000" min="0" step="any" value="">
      </div>
      <p class="hint">* ì›í™”ëŠ” í•´ì™¸ ê¸°ì¤€ì…ë‹ˆë‹¤. ê¹€ì¹˜í”„ë¦¬ë¯¸ì—„ì€ ì—…ë¹„íŠ¸Â·í•´ì™¸(BTC) ë¹„êµë¡œ ìë™ ê³„ì‚°ë˜ë©°, TORNì€ êµ­ë‚´ ë¯¸ìƒì¥ì´ë¼ ë™ì¼ ë¹„ìœ¨ ì ìš©.</p>
    </div>

    <div class="card card-dividend">
      <div class="card-title">â–¸ ì¶œê¸ˆ í†µê³¼ ì‹œ ë‚´ ë°°ë‹¹</div>
      <div class="share-block">
        <div class="share-header">
          <span class="share-label">í’€ ë‚´ ì ìœ  ë¹„ìœ¨</span>
          <span class="share-percent" id="shareText">0%</span>
        </div>
        <div class="share-bar-wrap">
          <div class="share-bar" id="shareBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="results">
        <div class="result-section-title">ETH ì¶œê¸ˆ</div>
        <div class="result-row">
          <span class="result-label">0.1 ETH ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="div01">0 TORN</span>
            <span class="result-krw" id="krw01">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">1 ETH ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="div1">0 TORN</span>
            <span class="result-krw" id="krw1">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">10 ETH ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="div10">0 TORN</span>
            <span class="result-krw" id="krw10">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">100 ETH ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="div100">0 TORN</span>
            <span class="result-krw" id="krw100">â€” ì›</span>
          </div>
        </div>
        <div class="result-section-divider"></div>
        <div class="result-section-title">WBTC ì¶œê¸ˆ</div>
        <div class="result-row">
          <span class="result-label">0.1 WBTC ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divWbtc01">0 TORN</span>
            <span class="result-krw" id="krwWbtc01">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">1 WBTC ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divWbtc1">0 TORN</span>
            <span class="result-krw" id="krwWbtc1">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">10 WBTC ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divWbtc10">0 TORN</span>
            <span class="result-krw" id="krwWbtc10">â€” ì›</span>
          </div>
        </div>
        <div class="result-section-divider"></div>
        <div class="result-section-title">USD ì¶œê¸ˆ</div>
        <div class="result-row">
          <span class="result-label">100 USD ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divUsd100">0 TORN</span>
            <span class="result-krw" id="krwUsd100">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">1,000 USD ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divUsd1000">0 TORN</span>
            <span class="result-krw" id="krwUsd1000">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">10,000 USD ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divUsd10000">0 TORN</span>
            <span class="result-krw" id="krwUsd10000">â€” ì›</span>
          </div>
        </div>
        <div class="result-row">
          <span class="result-label">100,000 USD ì¶œê¸ˆ ì‹œ</span>
          <div class="result-value-wrap">
            <span class="result-value" id="divUsd100000">0 TORN</span>
            <span class="result-krw" id="krwUsd100000">â€” ì›</span>
          </div>
        </div>
      </div>
    </div>

    <p class="footer-note">
      ETH / USD / WBTCê°€ í’€ì—ì„œ ì¶œê¸ˆë  ë•Œ 0.3% ìˆ˜ìˆ˜ë£Œê°€ ë°œìƒí•˜ê³ , ê·¸ ìˆ˜ìˆ˜ë£Œê°€ ë³´ìœ  ë¹„ìœ¨ëŒ€ë¡œ ìŠ¤í…Œì´ì»¤ì—ê²Œ ë°°ë‹¹ë©ë‹ˆë‹¤.<br>
      <a href="https://ipfs.io/ipfs/bafybeib4rg5gx7plrvzasrrqa3tcb3tnzm2goxhteaxsbem6hjpzsgihbu/" target="_blank" rel="noopener">í† ë„¤ì´ë„ ìºì‹œ ì›¹ì‚¬ì´íŠ¸</a>ì—ì„œ ìŠ¤í…Œì´í‚¹ ë° ì²­êµ¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
      <span class="hint">ì˜¤ë¥˜, ë²„ê·¸ ë¬¸ì˜ëŠ” <a href="https://t.me/koreatornadocash" target="_blank" rel="noopener">í•œêµ­ í…”ë ˆê·¸ë¨ ë°©</a>ìœ¼ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</span>
    </p>
  </div>

  <script>
    (function () {
      const ETHERSCAN_API_KEY = 'DSPENWH1HPF4H8P3WZNM6HCFT3G4238JM6';
      const TORN_TOKEN_ADDRESS = '0x77777FeDdddFfC19Ff86DB637967013e6C6A116C';
      const GOVERNANCE_CONTRACT_ADDRESS = '0x2F50508a8a3D323B91336FA3eA6ae50E55f32185';
      const TORN_DECIMALS = 18;
      const FEE_RATE = 0.003;
      const REFRESH_INTERVAL_MS = 60 * 1000;
      const NETWORK_ERR_MSG = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
      const WITHDRAW_AMOUNTS = [0.1, 1, 10, 100];
      const WITHDRAW_WBTC_AMOUNTS = [0.1, 1, 10];
      const WITHDRAW_USD_AMOUNTS = [100, 1000, 10000, 100000];
      const userTornInput = document.getElementById('userTorn');
      const totalPoolInput = document.getElementById('totalPool');
      const shareBar = document.getElementById('shareBar');
      const shareText = document.getElementById('shareText');
      const divEls = { 0.1: document.getElementById('div01'), 1: document.getElementById('div1'), 10: document.getElementById('div10'), 100: document.getElementById('div100') };
      const krwEls = { 0.1: document.getElementById('krw01'), 1: document.getElementById('krw1'), 10: document.getElementById('krw10'), 100: document.getElementById('krw100') };
      const divElsWbtc = { 0.1: document.getElementById('divWbtc01'), 1: document.getElementById('divWbtc1'), 10: document.getElementById('divWbtc10') };
      const krwElsWbtc = { 0.1: document.getElementById('krwWbtc01'), 1: document.getElementById('krwWbtc1'), 10: document.getElementById('krwWbtc10') };
      const divElsUsd = { 100: document.getElementById('divUsd100'), 1000: document.getElementById('divUsd1000'), 10000: document.getElementById('divUsd10000'), 100000: document.getElementById('divUsd100000') };
      const krwElsUsd = { 100: document.getElementById('krwUsd100'), 1000: document.getElementById('krwUsd1000'), 10000: document.getElementById('krwUsd10000'), 100000: document.getElementById('krwUsd100000') };
      const totalStakedDisplay = document.getElementById('totalStakedDisplay');
      const priceDisplay = document.getElementById('priceDisplay');
      const kimchiPremiumDisplay = document.getElementById('kimchiPremiumDisplay');

      function fetchTotalStaked() {
        const url = 'https://api.etherscan.io/v2/api?' + new URLSearchParams({
          chainid: '1',
          module: 'account',
          action: 'tokenbalance',
          contractaddress: TORN_TOKEN_ADDRESS,
          address: GOVERNANCE_CONTRACT_ADDRESS,
          tag: 'latest',
          apikey: ETHERSCAN_API_KEY
        });
        return fetch(url)
          .then(function (res) { return res.json(); })
          .then(function (data) {
            if (data.status !== '1' || data.message !== 'OK') {
              var errMsg = (typeof data.result === 'string' && data.result !== 'NOTOK')
                ? data.result
                : (data.message === 'NOTOK' ? 'Etherscan API ê±°ë¶€ (í‚¤/ì œí•œ í™•ì¸)' : (data.result || data.message || 'Etherscan API ì˜¤ë¥˜'));
              throw new Error(errMsg);
            }
            const raw = data.result;
            const balanceWei = typeof raw === 'string' ? raw : String(raw);
            var totalStaked = 0;
            if (balanceWei && balanceWei !== '0') {
              var len = balanceWei.length;
              if (len <= TORN_DECIMALS) {
                totalStaked = parseFloat('0.' + balanceWei.padStart(TORN_DECIMALS, '0'));
              } else {
                var intPart = balanceWei.slice(0, len - TORN_DECIMALS);
                var decPart = balanceWei.slice(-TORN_DECIMALS);
                totalStaked = parseFloat(intPart + '.' + decPart);
              }
            }
            return totalStaked;
          });
      }

      var tornPriceUsd = 0;
      var ethPriceUsd = 0;
      var btcPriceUsd = 0;
      var tornPriceKrw = 0;
      var kimchiPremiumAuto = null;

      function fetchPrices() {
        return fetch('https://api.coingecko.com/api/v3/simple/price?ids=tornado-cash,ethereum,bitcoin&vs_currencies=usd,krw')
          .then(function (res) { return res.json(); })
          .then(function (data) {
            if (data && data['tornado-cash']) {
              if (typeof data['tornado-cash'].usd === 'number') tornPriceUsd = data['tornado-cash'].usd;
              if (typeof data['tornado-cash'].krw === 'number') tornPriceKrw = data['tornado-cash'].krw;
            }
            if (data && data.ethereum && typeof data.ethereum.usd === 'number') ethPriceUsd = data.ethereum.usd;
            if (data && data.bitcoin && typeof data.bitcoin.usd === 'number') btcPriceUsd = data.bitcoin.usd;
            return { btcKrw: data && data.bitcoin && typeof data.bitcoin.krw === 'number' ? data.bitcoin.krw : null };
          });
      }

      function fetchKimchiPremium(btcKrwGlobal) {
        if (!btcKrwGlobal || btcKrwGlobal <= 0) return Promise.resolve(null);
        return fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC')
          .then(function (res) { return res.json(); })
          .then(function (arr) {
            if (!Array.isArray(arr) || !arr[0] || typeof arr[0].trade_price !== 'number') return null;
            var upbitBtcKrw = arr[0].trade_price;
            var premium = ((upbitBtcKrw - btcKrwGlobal) / btcKrwGlobal) * 100;
            return Math.round(premium * 100) / 100;
          })
          .catch(function () { return null; });
      }

      function setDataLoading(el, loading) {
        el.classList.toggle('loading', loading);
        el.classList.remove('error');
      }

      function setDataError(el, msg) {
        el.textContent = msg || 'â€” ì˜¤ë¥˜';
        el.classList.add('error');
        el.classList.remove('loading');
      }

      function updateMarketData() {
        setDataLoading(totalStakedDisplay, true);
        setDataLoading(priceDisplay, true);
        if (kimchiPremiumDisplay) {
          kimchiPremiumDisplay.textContent = 'â€” ë¡œë”© ì¤‘';
          kimchiPremiumDisplay.classList.add('loading');
        }

        fetchTotalStaked()
          .then(function (totalStaked) {
            const formatted = totalStaked >= 1
              ? Math.floor(totalStaked).toLocaleString('en') + ' TORN'
              : '0 TORN';
            totalStakedDisplay.textContent = formatted;
            totalStakedDisplay.classList.remove('loading');
            if (!totalPoolInput.value || parseFloat(totalPoolInput.value) === 0) {
              totalPoolInput.value = Math.floor(totalStaked);
              calculate();
            }
          })
          .catch(function (err) {
            var msg = err.message || 'ì¡°íšŒ ì‹¤íŒ¨';
            if (msg.indexOf('Failed to fetch') !== -1 || msg.indexOf('NetworkError') !== -1 || msg.indexOf('Load failed') !== -1) msg = NETWORK_ERR_MSG;
            setDataError(totalStakedDisplay, 'â€” ' + msg);
          });

        fetchPrices()
          .then(function (data) {
            var usdStr = '$' + (tornPriceUsd < 0.01 ? tornPriceUsd.toFixed(6) : tornPriceUsd.toFixed(2));
            priceDisplay.textContent = usdStr;
            priceDisplay.classList.remove('loading');
            return fetchKimchiPremium(data && data.btcKrw ? data.btcKrw : null);
          })
          .then(function (premium) {
            kimchiPremiumAuto = premium;
            if (kimchiPremiumDisplay) {
              kimchiPremiumDisplay.classList.remove('loading');
              if (premium != null) kimchiPremiumDisplay.textContent = premium + '%';
              else kimchiPremiumDisplay.textContent = 'â€”';
            }
            var usdStr = '$' + (tornPriceUsd < 0.01 ? tornPriceUsd.toFixed(6) : tornPriceUsd.toFixed(2));
            if (tornPriceKrw > 0) {
              var krwVal = tornPriceKrw;
              if (premium != null) krwVal = krwVal * (1 + premium / 100);
              priceDisplay.innerHTML = usdStr + ' <span class="price-krw-ref">' + Math.floor(krwVal).toLocaleString('ko-KR') + ' ì›</span>';
            }
            calculate();
          })
          .catch(function (err) {
            var msg = err.message || 'ì¡°íšŒ ì‹¤íŒ¨';
            if (msg.indexOf('Failed to fetch') !== -1 || msg.indexOf('NetworkError') !== -1 || msg.indexOf('Load failed') !== -1) msg = NETWORK_ERR_MSG;
            setDataError(priceDisplay, 'â€” ' + msg);
            if (kimchiPremiumDisplay) { kimchiPremiumDisplay.textContent = 'â€”'; kimchiPremiumDisplay.classList.remove('loading'); }
          });
      }

      function parseNum(value) {
        const n = parseFloat(String(value).replace(/,/g, ''));
        return isNaN(n) || n < 0 ? 0 : n;
      }

      function formatEth(n) {
        if (n >= 1) return n.toFixed(4) + ' ETH';
        if (n > 0) return n.toFixed(6) + ' ETH';
        return '0 ETH';
      }

      function ethToTorn(ethAmount) {
        if (!tornPriceUsd || tornPriceUsd <= 0 || !ethPriceUsd || ethPriceUsd <= 0) return null;
        return (ethAmount * ethPriceUsd) / tornPriceUsd;
      }

      function btcToTorn(btcAmount) {
        if (!tornPriceUsd || tornPriceUsd <= 0 || !btcPriceUsd || btcPriceUsd <= 0) return null;
        return (btcAmount * btcPriceUsd) / tornPriceUsd;
      }

      function formatTorn(n) {
        if (n == null) return '';
        if (n >= 1e3) return n.toFixed(2) + ' TORN';
        if (n >= 1) return n.toFixed(2) + ' TORN';
        if (n > 0) return n.toFixed(4) + ' TORN';
        return '0 TORN';
      }

      function formatKrw(n) {
        if (n == null || n <= 0) return 'â€” ì›';
        return Math.floor(n).toLocaleString('ko-KR') + ' ì›';
      }

      function calculate() {
        const userTorn = parseNum(userTornInput.value);
        const totalPool = parseNum(totalPoolInput.value);

        var sharePercent = 0;
        if (totalPool > 0 && userTorn > 0) {
          sharePercent = Math.min(100, (userTorn / totalPool) * 100);
        }

        shareBar.style.width = sharePercent + '%';
        shareText.textContent = sharePercent.toFixed(4) + '%';

        function updateRow(ethAmount, el, krwEl) {
          var totalFee = ethAmount * FEE_RATE;
          var myDividendEth = totalPool > 0 && userTorn > 0 ? totalFee * (userTorn / totalPool) : 0;
          var myDividendTorn = ethToTorn(myDividendEth);
          if (el) el.textContent = myDividendTorn != null ? formatTorn(myDividendTorn) : formatEth(myDividendEth);
          if (krwEl) {
            var baseKrw = (myDividendTorn != null && tornPriceKrw > 0) ? myDividendTorn * tornPriceKrw : 0;
            var premium = kimchiPremiumAuto != null ? kimchiPremiumAuto : 0;
            if (baseKrw > 0 && premium !== 0) baseKrw = baseKrw * (1 + premium / 100);
            krwEl.textContent = baseKrw > 0 ? formatKrw(baseKrw) : 'â€” ì›';
          }
        }

        WITHDRAW_AMOUNTS.forEach(function (ethAmount) {
          updateRow(ethAmount, divEls[ethAmount], krwEls[ethAmount]);
        });

        WITHDRAW_WBTC_AMOUNTS.forEach(function (wbtcAmount) {
          var totalFeeBtc = wbtcAmount * FEE_RATE;
          var myDividendBtc = totalPool > 0 && userTorn > 0 ? totalFeeBtc * (userTorn / totalPool) : 0;
          var myDividendTorn = btcToTorn(myDividendBtc);
          var el = divElsWbtc[wbtcAmount];
          var krwEl = krwElsWbtc[wbtcAmount];
          if (el) el.textContent = myDividendTorn != null ? formatTorn(myDividendTorn) : '0 TORN';
          if (krwEl) {
            var baseKrw = (myDividendTorn != null && tornPriceKrw > 0) ? myDividendTorn * tornPriceKrw : 0;
            var premium = kimchiPremiumAuto != null ? kimchiPremiumAuto : 0;
            if (baseKrw > 0 && premium !== 0) baseKrw = baseKrw * (1 + premium / 100);
            krwEl.textContent = baseKrw > 0 ? formatKrw(baseKrw) : 'â€” ì›';
          }
        });

        WITHDRAW_USD_AMOUNTS.forEach(function (usdAmount) {
          var equivalentEth = ethPriceUsd > 0 ? usdAmount / ethPriceUsd : 0;
          updateRow(equivalentEth, divElsUsd[usdAmount], krwElsUsd[usdAmount]);
        });
      }

      [userTornInput, totalPoolInput].forEach(function (el) {
        el.addEventListener('input', calculate);
        el.addEventListener('change', calculate);
      });

      updateMarketData();
      calculate();
      setInterval(updateMarketData, REFRESH_INTERVAL_MS);
    })();
  </script>
</body>
</html>
